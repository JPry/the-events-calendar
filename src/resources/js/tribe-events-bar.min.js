var tribe_events_bar_action;!function(e,t,a,r,i,o,s,n,l){a(t).ready(function(){function b(e){if(!e.parents(".tribe-bar-disabled").length){var t=e.width();t>800?e.removeClass("tribe-bar-mini tribe-bar-collapse").addClass("tribe-bar-full"):e.removeClass("tribe-bar-full").addClass("tribe-bar-mini"),t<728?e.removeClass("tribe-bar-mini").addClass("tribe-bar-collapse"):e.removeClass("tribe-bar-collapse")}}function c(){if(tribe_events_bar_action="change_view","month"===s.view&&p.length){var r=p.val(),l=o.get_day();"0"!==s.datepicker_format?l.length?(r=tribeDateFormat(p.bootstrapDatepicker("getDate"),"tribeMonthQuery"),p.val(r+l)):p.val(""):7===r.length&&p.val(r+l)}s.url_params={},a(i).trigger("tribe_ev_preCollectBarParams"),a(i).trigger("pre-collect-bar-params.tribe");var b=a(t.getElementById("tribe-bar-form")).add(t.getElementById("tribe_events_filters_wrapper")),c=b.find("input, select");c.each(function(){var e=a(this);e.val()&&e.val().length&&!e.hasClass("tribe-no-param")&&("month"!==s.view&&"0"!==s.datepicker_format&&e.is(p)?s.url_params[e.attr("name")]=tribeDateFormat(e.bootstrapDatepicker("getDate"),"tribeQuery"):e.is(":checkbox")?e.is(":checked")&&(s.url_params[e.attr("name")]=e.val()):s.url_params[e.attr("name")]=e.val())}),s.url_params=a.param(s.url_params),a(i).trigger("tribe_ev_postCollectBarParams"),a(i).trigger("post-collect-bar-params.tribe"),s.url_params.length&&(s.cur_url+=n.starting_delim()+s.url_params),e.location.href=s.cur_url}a("select").selectability(),l&&(a().bootstrapDatepicker||debug.warn("TEC Debug: vendor bootstrapDatepicker was not loaded before its dependant file tribe-events-bar.js"),a().placeholder||debug.warn("TEC Debug: vendor placeholder was not loaded before its dependant file tribe-events-bar.js"));var d=a("#tribe-bar-form"),p=a("#tribe-bar-date"),u=a("#tribe-events-header"),h=0;if(u.length&&(h=u.data("startofweek")),b(d),d.resize(function(){b(d)}),!a(".tribe-events-week-grid").length&&"month"!==s.view){var v="yyyy-mm-dd";if("0"!==s.datepicker_format){v=r.datepicker_formats.main[s.datepicker_format];var m=o.get_url_param("tribe-bar-date");m?p.val(tribeDateFormat(m,s.datepicker_format)):"day"===s.view&&0!==p.val().length&&p.val(tribeDateFormat(p.val(),s.datepicker_format))}l&&debug.info('TEC Debug: bootstrapDatepicker was just initialized in "tribe-events-bar.js" on:',p),r.datepicker_opts={weekStart:h,format:v,autoclose:!0},p.bootstrapDatepicker(r.datepicker_opts)}p.blur(function(){""===p.val()&&a(".datepicker.dropdown-menu").is(":hidden")&&n.live_ajax()&&n.pushstate&&(s.date=r.cur_date,r.cur_url=r.base_url,a(i).trigger("tribe_ev_runAjax"),a(i).trigger("run-ajax.tribe"))}),a(".tribe-bar-settings").length&&a("#tribe-events-bar").addClass("tribe-has-settings"),a("#tribe-events-bar .hasDatepicker").length&&a("#tribe-events-bar").addClass("tribe-has-datepicker"),o.maybe_default_view_change(),d.on("change",".tribe-bar-views-select",function(e){e.preventDefault();var t=a("option:selected",this),r=t.data("view");s.cur_url=a("option[data-view="+r+"]").val(),s.view_target=a('select[name=tribe-bar-view] option[value="'+s.cur_url+'"]').data("view"),tribe_events_bar_action="change_view",c()}),d.on("click","#tribe-bar-collapse-toggle",function(){a(this).toggleClass("tribe-bar-filters-open"),a(".tribe-bar-filters").slideToggle("fast")}),a('label[for="tribe-bar-date"], input[name="tribe-bar-date"]').wrapAll('<div id="tribe-bar-dates" />'),a("#tribe-bar-filters").before(a("#tribe-bar-dates")),a(i).on("tribe_ev_serializeBar",function(){a("form#tribe-bar-form input, form#tribe-bar-form select, #tribeHideRecurrence").each(function(){var e=a(this);if(e.is("#tribe-bar-date")){var t=e.val();t.length?"month"===s.view?(s.params[e.attr("name")]=tribeDateFormat(s.mdate,"tribeMonthQuery"),s.url_params[e.attr("name")]=tribeDateFormat(s.mdate,"tribeMonthQuery")):t.match(/[0-9]{4}-[0-9]{2}/)?s.params[e.attr("name")]=s.url_params[e.attr("name")]=t:(s.params[e.attr("name")]=tribeDateFormat(e.bootstrapDatepicker("getDate"),"tribeQuery"),s.url_params[e.attr("name")]=tribeDateFormat(e.bootstrapDatepicker("getDate"),"tribeQuery")):e.is(".placeholder")&&e.is(".bd-updated")?s.url_params[e.attr("name")]=e.attr("data-oldDate"):s.date=r.cur_date}!e.val().length||e.hasClass("tribe-no-param")||e.is("#tribe-bar-date")||(e.is(":checkbox")?e.is(":checked")&&(s.params[e.attr("name")]=e.val(),"map"!==s.view&&(s.url_params[e.attr("name")]=e.val()),("month"===s.view||"day"===s.view||"week"===s.view||s.recurrence)&&s.pushcount++):(s.params[e.attr("name")]=e.val(),"map"!==s.view&&(s.url_params[e.attr("name")]=e.val()),"month"!==s.view&&"day"!==s.view&&"week"!==s.view||s.pushcount++))})});var f=a('#tribe-events-bar [class^="tribe-bar-button-"]'),x=f.next(".tribe-bar-drop-content");f.click(function(){var e=a(this);return e.toggleClass("open"),e.next(".tribe-bar-drop-content").toggle(),!1}),a(t).click(function(){a("#tribe-bar-views").removeClass("tribe-bar-views-open"),f.hasClass("open")&&(f.removeClass("open"),x.hide())}),x.click(function(e){e.stopPropagation()}),l&&debug.info("TEC Debug: tribe-events-bar.js successfully loaded")})}(window,document,jQuery,tribe_ev.data,tribe_ev.events,tribe_ev.fn,tribe_ev.state,tribe_ev.tests,tribe_debug),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){"use strict";function t(e){this.element=e,this.buildElements(),this.stealLabel(),this.synchronizeAttributes(),this.populateText(),this.registerHandlers(),e.attr("tabindex",-1).addClass("selectability-offscreen")}var a=13,r=32,i=37,o=38,s=39,n=40,l=27;e.fn.selectability=function(){return this.each(function(){var a=e(this);a.data("selectability")||a.data("selectability",new t(a))}),this};var b=function(){var e=0;return function(){var t;do t="selectability#id"+e++;while(document.getElementById(t));return t}}();t.prototype.buildElements=function(){this.textbox=e("<div></div>").attr({role:"textbox",tabindex:-1,"aria-readonly":"true"}),this.listbox=e("<div></div>").attr({role:"listbox",tabindex:-1,"aria-multiselectable":"false"}),this.combobox=e("<div></div>").addClass("selectability").attr({role:"combobox application",tabindex:0,"aria-expanded":"false"}),this.combobox.append(this.textbox).append(this.listbox),this.element.before(this.combobox)},t.prototype.stealLabel=function(){var t=this.element.attr("id"),a=this.element.attr("aria-label");this.element.attr("data-view");if(a)return void this.combobox.attr("aria-label",a);if(t){var r=[];e("label[for]").filter(function(){return e(this).attr("for")===t}).each(function(){var t=e(this),a=b();t.removeAttr("for"),t.attr("id",a),r.push(a)}),this.combobox.attr("aria-labelledby",r.join(" "))}},t.prototype.populateText=function(e){if(!e||!e.selectability){var t=this.element.find(":selected");t.length&&this.textbox.text(t.attr("label")||t.text()).prepend('<span class="tribe-icon '+t.text().toLowerCase()+'"></span>')}},t.prototype.synchronizeAttributes=function(){if(this.element.prop("multiple"))throw new Error("Can only bind to single selection widgets");this.disabled=!!this.element.prop("disabled"),this.combobox.attr({"aria-disabled":this.disabled,"aria-required":!!this.element.prop("required")})},t.prototype.registerHandlers=function(){this.observeProperties(),this.registerEvents()},t.prototype.observeProperties=function(){var t=e.proxy(this.synchronizeAttributes,this),a=window.MutationObserver||window.MozMutationObserver||window.WebkitMutationObserver;a?(this.observer=new a(t),this.observer.observe(this.element[0],{attributes:!0,attributeFilter:["multiple","disabled","required"]})):this.element.on({"propertychange.selectability":t,"focus.selectability":t}),this.element.change(e.proxy(this.populateText,this))},t.prototype.registerEvents=function(){var t=this;this.combobox.on({focusout:function(a){var r=this;setTimeout(function(){e.contains(r,document.activeElement)||t.closeCombobox()},0)},click:e.proxy(this.comboboxClick,this),keydown:e.proxy(this.comboboxKeydown,this)}),this.listbox.on({click:e.proxy(this.listboxClick,this),keydown:e.proxy(this.listboxKeydown,this)})},t.prototype.comboboxClick=function(){this.disabled||this.toggleCombobox()},t.prototype.comboboxKeydown=function(e){if(!this.disabled)switch(e.which){case a:case r:if("true"===this.combobox.attr("aria-expanded"))return this.closeCombobox(),this.combobox.focus(),e.preventDefault(),!1;case o:case n:case i:case s:return"true"!==this.combobox.attr("aria-expanded")&&this.openCombobox(),this.active.focus(),e.preventDefault(),!1;case l:return this.closeCombobox(),this.combobox.focus(),e.preventDefault(),!1}},t.prototype.listboxClick=function(t){var a=e(t.target);if("option"===a.attr("role")&&"true"!==a.attr("aria-disabled"))return this.setActive(e(t.target)),this.closeCombobox(),t.preventDefault(),!1},t.prototype.setActive=function(t){var a=this.listbox.find("[role=option]").index(t),r=this.element.find("option").eq(a).val(),i=this.element.val(),o=e.Event("change",{val:r,selectability:!0});if(this.element.val()!==r){this.element.val(r);try{this.element.trigger(o)}finally{o.isDefaultPrevented()?this.element.val(i):(this.active=t,this.textbox.text(t.attr("label")||t.text()))}}},t.prototype.listboxKeydown=function(t){switch(t.which){case a:case r:return this.setActive(e(t.target)),this.closeCombobox(),this.combobox.focus(),t.preventDefault(),!1;case i:case o:return t.preventDefault(),this.moveFocusUp(),!1;case s:case n:return t.preventDefault(),this.moveFocusDown(),!1}},t.prototype.toggleCombobox=function(){"true"===this.combobox.attr("aria-expanded")?this.closeCombobox():(this.openCombobox(),this.active&&this.active.focus())},t.prototype.closeCombobox=function(){this.active=null,this.listbox.empty(),this.combobox.attr("aria-expanded",!1)},t.prototype.openCombobox=function(){this.populateListbox(),this.combobox.attr("aria-expanded",!0)},t.prototype.populateListbox=function(){function t(a){var r=e("<div></div>"),i=this;return e.each(a,function(a,o){var s=e("<div></div>");if(o=e(o),o.is("option"))s.text(o.attr("label")||o.text()).prepend('<span class="tribe-icon '+o.text().toLowerCase()+'"></span>').attr({role:"option",tabindex:-1,"aria-disabled":!!o.prop("disabled"),"aria-selected":o.val()===i.element.val()}).appendTo(r),o.prop("disabled")?s.removeAttr("tabindex"):o.val()===i.element.val()&&(i.active=s);else if(o.is("optgroup")){var n=t.call(i,o.children());if(n.children().length){var l=e("<div></div>").text(o.attr("label")).attr({role:"heading",id:b()});s.attr({role:"group","aria-labelledby":l.attr("id")}).append(n.prepend(l).children()).appendTo(r)}}}),r}this.populateText();var a=t.call(this,this.element.children()).children();this.listbox.append(a)},t.prototype.moveFocusUp=function(){for(var t=this.listbox.find("[role=option]"),a=t.index(this.active[0])-1;a>=0;a--){var r=e(t[a]);if("false"===r.attr("aria-disabled")){this.active.attr("aria-selected","false"),this.active=r,this.active.attr("aria-selected",!0).focus();break}}},t.prototype.moveFocusDown=function(){for(var t=this.listbox.find("[role=option]"),a=t.index(this.active[0])+1;a<t.length;a++){var r=e(t[a]);if("false"===r.attr("aria-disabled")){this.active.attr({"aria-selected":"false"}),this.active=r,this.active.attr("aria-selected",!0).focus();break}}}});